# 🎯 실시간 얼굴 매칭 시스템 v2.0

OpenCV를 사용한 **웹캠** 및 **MP4 비디오 파일** 기반 실시간 얼굴 인식 및 매칭 프로그램입니다.

## 📋 주요 기능

- **🎥 다중 입력 지원**: 웹캠 실시간 영상 + MP4 비디오 파일
- **🔍 실시간 얼굴 검출**: Haar Cascade를 통한 빠른 얼굴 검출
- **🎯 정밀 얼굴 매칭**: 듀얼 알고리즘 (템플릿 매칭 + 히스토그램 비교)
- **🎨 시각적 피드백**: 매칭된 얼굴에 **빨간색 굵은 테두리** 표시
- **📊 실시간 점수**: 매칭 정확도를 퍼센트로 실시간 표시
- **⏯️ 비디오 제어**: MP4 파일 일시정지/재생 기능

## 🛠️ 요구사항

### 시스템 요구사항
- Linux/Ubuntu 환경
- C++17 지원 컴파일러
- 웹캠 (선택사항 - 웹캠 모드용)
- MP4 비디오 파일 (선택사항 - 비디오 모드용)

### 필수 라이브러리
```bash
sudo apt-get update
sudo apt-get install -y \
    libopencv-dev \
    cmake \
    build-essential \
    wget
```

## 🚀 설치 및 실행

### 1. 프로젝트 빌드
```bash
# 빌드 스크립트 실행
./build.sh
```

### 2. 필요한 파일 준비
```bash
# 얼굴 사진 준비 (images 폴더에 저장)
# 예: ./images/my_face.jpg

# MP4 비디오 파일 준비 (선택사항, videos 폴더에 저장)  
# 예: ./videos/test_video.mp4
```

### 3. 프로그램 실행
```bash
./face_matcher

# 실행 후 다음을 선택:
# 1. 기준 얼굴 이미지 경로 입력
# 2. 입력 소스 선택 (웹캠 or MP4 파일)
# 3. 얼굴 매칭 시작
```

## 📸 얼굴 사진 준비 가이드

### 좋은 기준 사진의 조건
- **정면 얼굴**: 카메라를 정면으로 바라보는 사진
- **적절한 조명**: 너무 밝거나 어두우지 않은 균등한 조명
- **선명한 화질**: 흐리지 않은 선명한 사진
- **적절한 크기**: 얼굴이 너무 작거나 크지 않게

### 권장 사진 사양
- 해상도: 300x300 이상
- 형식: JPG, PNG
- 얼굴 크기: 이미지의 30-70% 차지

## 🎮 사용법

### 프로그램 시작 순서
1. **기준 얼굴 이미지 입력**: 자신의 얼굴 사진 경로 입력
2. **입력 소스 선택**: 
   - `1` - 웹캠 실시간 모드
   - `2` - MP4 비디오 파일 모드
3. **매칭 임계값 설정**: (선택사항, 기본값: 70%)
4. **얼굴 매칭 실행**: 실시간 매칭 시작

### 실행 중 조작법
| 키 | 기능 | 지원 모드 |
|---|---|---|
| `ESC` 또는 `q` | 프로그램 종료 | 모든 모드 |
| `SPACE` | 일시정지/재생 | MP4 비디오만 |
| `t` | 매칭 임계값 실시간 조정 | 모든 모드 |
| `s` | 현재 화면 스크린샷 저장 | 모든 모드 |

### 매칭 결과 해석
- **빨간색 테두리**: 매칭 성공 (임계값 이상)
- **노란색 테두리**: 얼굴 검출됨 (매칭 실패)
- **매칭 점수**: 실시간 유사도 퍼센트 표시

## 🔧 매개변수 조정

### 매칭 임계값
- **높은 값 (80-90%)**: 엄격한 매칭, 정확도 높음, 민감도 낮음
- **중간 값 (60-80%)**: 균형잡힌 성능 (권장)
- **낮은 값 (40-60%)**: 관대한 매칭, 민감도 높음, 오검출 가능

### 최적화 팁
- 조명이 일정한 환경에서 테스트
- 웹캠과 30-50cm 거리 유지
- 정면을 향하도록 자세 유지

## 🧠 알고리즘 설명

### 얼굴 검출
- **Haar Cascade Classifier** 사용
- OpenCV의 사전 훈련된 모델 활용
- 실시간 얼굴 영역 검출

### 매칭 알고리즘
두 가지 방법의 조합:

1. **템플릿 매칭 (60%)**
   - 정규화된 상관계수 매칭
   - 얼굴 구조적 유사성 비교

2. **히스토그램 비교 (40%)**
   - HSV 색상 히스토그램 분석
   - 색상 분포 유사성 측정

### 전처리 과정
- 크기 정규화 (150x150)
- CLAHE를 통한 조명 보정
- 히스토그램 균등화

## 📁 파일 구조

```
Project4/
├── main.cpp                      # 메인 프로그램 (웹캠 + MP4 지원)
├── face_matcher.h                # FaceMatcher 클래스 헤더
├── face_matcher.cpp              # FaceMatcher 클래스 구현
├── CMakeLists.txt                # CMake 설정
├── build.sh                      # 빌드 스크립트  
├── README.md                     # 이 파일
├── images/                       # 얼굴 이미지 폴더
│   ├── sample_face.jpg          # 샘플 이미지
│   └── test_face.jpg            # 테스트 이미지
├── videos/                       # MP4 비디오 폴더
│   └── test_sample.mp4          # 샘플 비디오
├── haarcascade_frontalface_*.xml # Haar Cascade 파일들
└── build/                        # 빌드 파일들
```

## 🛟 문제 해결

### 빌드 오류
```bash
# OpenCV 재설치
sudo apt-get remove libopencv-dev
sudo apt-get install libopencv-dev

# 의존성 확인
pkg-config --modversion opencv4
```

### 웹캠 인식 실패
```bash
# 웹캠 장치 확인
ls /dev/video*

# 권한 확인
sudo chmod 666 /dev/video0
```

### 얼굴 검출 실패
- Haar cascade 파일이 다운로드되었는지 확인
- 조명 조건 개선
- 카메라 각도 조정

## 🎓 개발 정보

- **언어**: C++17
- **라이브러리**: OpenCV 4.x
- **빌드 시스템**: CMake
- **플랫폼**: Linux/Ubuntu

## 📈 성능 개선 방향

- 딥러닝 기반 얼굴 인식 적용 (dlib, face_recognition)
- 다중 얼굴 동시 매칭
- 얼굴 랜드마크 기반 정밀 매칭
- GPU 가속 처리

---

**🌟 즐거운 얼굴 매칭 테스트 되세요! 🌟**